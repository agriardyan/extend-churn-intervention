# Anti-Churn Pipeline Configuration
# This file defines the rules and actions for the anti-churn system.

# Rules detect churn signals and trigger actions
rules:
  # Rage Quit Rule - Detects when a player quits after consecutive losses
  - id: rage-quit
    type: rage_quit
    enabled: true
    actions: [comeback-challenge, grant-item]  # Actions to execute when triggered
    parameters:
      threshold: 3  # Number of consecutive losses before triggering
    cooldown:
      duration: 24h  # Don't trigger again for 24 hours
      per_user: true

  # Losing Streak Rule - Detects extended losing streaks
  - id: losing-streak
    type: losing_streak
    enabled: true
    actions: [comeback-challenge, grant-item]  # Same actions as rage quit
    parameters:
      threshold: 5  # Number of consecutive losses
    cooldown:
      duration: 48h
      per_user: true

  # Session Decline Rule - Detects significant drop in play sessions
  - id: session-decline
    type: session_decline
    enabled: true
    actions: [comeback-challenge]  # Only challenge, no item grant
    parameters:
      decline_threshold: 0.5  # 50% decline from last week
      min_sessions_last_week: 3  # Minimum sessions last week to qualify
    cooldown:
      duration: 168h  # 7 days
      per_user: true

# Actions are executed when rules trigger
actions:
  # Comeback Challenge - Creates a time-limited challenge
  - id: comeback-challenge
    type: comeback_challenge
    enabled: true
    parameters:
      wins_needed: 3
      duration_days: 7
      cooldown_hours: 168  # 7 days between challenges

  # Grant Item - Rewards the player with an item
  - id: grant-item
    type: grant_item
    enabled: true
    parameters:
      item_id: ${REWARD_ITEM_ID:COMEBACK_REWARD}
      quantity: 1
      source: "anti_churn_system"
      test_mode: ${TEST_MODE:false}  # Set to true to test without actual grants
